---
title: 函数块中的新成员
---
# 函数块中的新成员

在其主入口点函数中，每个 AEIO 插件必须填充一个 `AEIO_FunctionBlock`，提供 After Effects 将调用的函数指针，以处理不同的文件相关任务。

下表显示了输入需要哪些函数，输出需要哪些函数。对于最基本的实现，请从右侧标记为“必需”的函数开始。通常可以通过让 After Effects 为您处理调用来实现“最佳情况”行为（通过返回 `AEIO_Err_USE_DFLT_CALLBACK`）。

对于仅用于视频输入的最基本 AEIO，请实现以下函数：`AEIO_InitInSpecFromFile` 或 `AEIO_InitInSpecInteractive`（取决于源是文件还是交互生成的），`AEIO_DisposeInSpec`，`AEIO_GetInSpecInfo`，`AEIO_DrawSparseFrame`，`AEIO_CloseSourceFiles` 和 `AEIO_InqNextFrameTime`（使用 `AEIO_Err_USE_DFLT_CALLBACK` 是可以的）。

从 IO 示例开始，最好也保留其他函数的定义，并根据需要进一步填充它们。

---

## AEIO_FunctionBlock4

|           函数            |                                                                                                                                                                                                                                                           响应                                                                                                                                                                                                                                                           | 输入或输出？ |                       必需？                       |
|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|----------------------------------------------------|
| `AEIO_InitInSpecFromFile`     | 给定文件路径，在提供的 `AEIO_InSpecH` 中描述其内容。                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 输入         | 是，适用于基于文件的媒体                             |
|                               | 使用 [AEGP_IOInSuite](#aegp_ioinsuite5) 中的所有适当“set”调用来完成此操作；如果有图像数据，请设置其深度、尺寸和 Alpha 解释。                                                                                                                                                                                                                                                                                                                                                                                                 |              |                                                    |
|                               | 如果有音频，请描述其声道和采样率。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |              |                                                    |
|                               | 文件路径是一个以 NULL 结尾的 UTF-16 字符串，带有平台分隔符。                                                                                                                                                                                                                                                                                                                                                                                                                                                               |              |                                                    |
|                               | <pre lang="cpp">AEIO_InitInSpecFromFile(<br/>  AEIO_BasicData     \*basic_dataP,<br/>  const A_UTF16Char  \*file_pathZ,<br/>  AEIO_InSpecH       inH);</pre>                                                                                                                                                                                                                                                                                                                                                                 |              |                                                    |
| `AEIO_InitInSpecInteractive`  | 使用某种形式的用户交互（而不是由 After Effects 提供的文件路径），描述生成的 `AEIO_InSpecH` 中包含的音频和视频。                                                                                                                                                                                                                                                                                                                                                                                                             | 输入         | 是，适用于交互生成的媒体                             |
|                               | <pre lang="cpp">AEIO_InitInSpecInteractive(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH);</pre>                                                                                                                                                                                                                                                                                                                                                                                                           |              |                                                    |
| `AEIO_DisposeInSpec`          | 释放 `AEIO_InSpecH`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 输入         | 是                                                 |
|                               | <pre lang="cpp">AEIO_DisposeInSpec(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH);</pre>                                                                                                                                                                                                                                                                                                                                                                                                                   |              |                                                    |
| `AEIO_FlattenOptions`         | 对于给定的 `AEIO_InSpecH`，返回其选项句柄中包含的数据的扁平化版本。                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 输入         | 否                                                 |
|                               | 使用 `AEGP_GetInSpecOptionsHandle` 获取未扁平化的选项句柄。                                                                                                                                                                                                                                                                                                                                                                                                                                                                |              |                                                    |
|                               | <pre lang="cpp">AEIO_FlattenOptions(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  AEIO_Handle     \*flat_optionsPH);</pre>                                                                                                                                                                                                                                                                                                                                                                          |              |                                                    |
| `AEIO_InflateOptions`         | 对于给定的 `AEIO_InSpecH`，使用 `AEGP_SetInSpecOptionsHandle` 创建其扁平化选项数据的未扁平化版本。                                                                                                                                                                                                                                                                                                                                                                                                                          | 输入         | 否                                                 |
|                               | <pre lang="cpp">AEIO_InflateOptions(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  AEIO_Handle     flat_optionsH);</pre>                                                                                                                                                                                                                                                                                                                                                                             |              |                                                    |
| `AEIO_SynchInSpec`            | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。检查 `AEIO_InSpecH`，（必要时更新其选项），并指示是否进行了更改。                                                                                                                                                                                                                                                                                                                                                                                                                        | 输入         | 否                                                 |
|                               | <pre lang="cpp">AEIO_SynchInSpec(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  A_Boolean       \*changed0);</pre>                                                                                                                                                                                                                                                                                                                                                                                   |              |                                                    |
| `AEIO_GetActiveExtent`        | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。使用给定时间的文件像素的活动范围填充提供的 `A_LRect`。                                                                                                                                                                                                                                                                                                                                                                                                                                   | 输入         | 是                                                 |
|                               | <pre lang="cpp">AEIO_GetActiveExtent(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  const A_Time    \*tr,<br/>  A_LRect         \*extent);</pre>                                                                                                                                                                                                                                                                                                                                                     |              |                                                    |
| `AEIO_GetInSpecInfo`          | 在 `AEIO_Verbiage` 中提供一些字符串来描述文件，这些字符串将出现在项目面板中。这包括用于描述文件类型和子类型（编解码器）的字符串。                                                                                                                                                                                                                                                                                                                                                                                           | 输入         | 是                                                 |
|                               | <pre lang="cpp">AEIO_GetInSpecInfo(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  AEIO_Verbiage   \*verbiageP);</pre>                                                                                                                                                                                                                                                                                                                                                                                |              |                                                    |
|                               | 此函数被频繁调用；每次刷新项目面板时都会调用。尽量减少内存分配。                                                                                                                                                                                                                                                                                                                                                                                                                                                             |              |                                                    |
|                               | 在 After Effects 附带的 AEIO 中，我们检查有效的 `optionsH`（使用 `AEGP_GetInSpecOptionsHandle`）；如果找到，我们使用其中的信息。如果没有，我们什么也不做。                                                                                                                                                                                                                                                                                                                                                                   |              |                                                    |
|                               | 这很重要；如果您的 AEIO 处理静态图像，此函数 *将* 被调用以处理包含静态图像的文件夹。希望不会有与之关联的 `optionsH`（除非您正在编写一个非常奇怪的 AEIO）。                                                                                                                                                                                                                                                                                                                                                                   |              |                                                    |
| `AEIO_DrawSparseFrame`        | 从 `AEIO_InSpecH` 绘制一帧。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 输入         | 是                                                 |
|                               | `PF_EffectWorld*` 包含要使用的宽度和高度，但如果 `required_region0` 不是 `NULL`，请确保考虑到它。                                                                                                                                                                                                                                                                                                                                                                                                                           |              |                                                    |
|                               | <pre lang="cpp">AEIO_DrawSparseFrame(<br/>  AEIO_BasicData            \*basic_dataP,<br/>  AEIO_InSpecH              inH,<br/>  AEIO_Quality              qual,<br/>  const AEIO_RationalScale  \*rs0,<br/>  const A_Time              \*tr,<br/>  const A_Time              \*duration0,<br/>  const A_Rect               \*required_region0,<br/>  PF_EffectWorld            \*wP,<br/>  A_long*                   originx,<br/>  A_long*                   originy,<br/>  AEIO_DrawingFlags         \*draw_flagsP);</pre> |              |                                                    |
|                               | 注意：返回的数据应为线性光（1.0），After Effects 将执行任何必要的转换以将素材带入工作色彩空间。                                                                                                                                                                                                                                                                                                                                                                                                                             |              |                                                    |
| `AEIO_GetDimensions`          | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。提供 `AEIO_InSpecH` 中视频的尺寸（以及必要的缩放因子）。                                                                                                                                                                                                                                                                                                                                                                                                                                 | 输入         | 否                                                 |
|                               | <pre lang="cpp">AEIO_GetDimensions(<br/>  AEIO_BasicData            \*basic_dataP,<br/>  AEIO_InSpecH              inH,<br/>  const AEIO_RationalScale  \*rs0,<br/>  A_long                    \*width0,<br/>  A_long                    \*height0);</pre>                                                                                                                                                                                                                                                                   |              |                                                    |
| `AEIO_GetDuration`            | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。提供 `AEIO_InSpecH` 的持续时间（以秒为单位）。                                                                                                                                                                                                                                                                                                                                                                                                                                           | 输入         | 否                                                 |
|                               | <pre lang="cpp">AEIO_GetDuration(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  A_Time          \*trP);</pre>                                                                                                                                                                                                                                                                                                                                                                                        |              |                                                    |
| `AEIO_GetTime`                | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。提供 `AEIO_InSpecH` 的时间基准。                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 输入         | 否                                                 |
|                               | <pre lang="cpp">AEIO_GetTime(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  A_Time          \*tr);</pre>                                                                                                                                                                                                                                                                                                                                                                                             |              |                                                    |
|                               | 以下是我们内部用于常见时间基准的值：                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |              |                                                    |
|                               | - 29.97 fps: `scale = 100; value= 2997;`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |              |                                                    |
|                               | - 59.94 fps: `scale = 50; value = 2997;`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |              |                                                    |
|                               | - 23.976 fps: `scale = 125; value = 2997;`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |              |                                                    |
|                               | - 30 fps: `scale = 1; value = 30;`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |              |                                                    |
|                               | - 25 fps: `scale = 1; value = 25;`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |              |                                                    |
| `AEIO_GetSound`               | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。以描述的品质提供 `AEIO_InSpecH` 中的声音。                                                                                                                                                                                                                                                                                                                                                                                                                                              | 输入         | 否                                                 |
|                               | <pre lang="cpp">AEIO_GetSound(<br/>  AEIO_BasicData             \*basic_dataP,<br/>  AEIO_InSpecH               inH,<br/>  AEIO_SndQuality            quality,<br/>  const AEIO_InterruptFuncs  \*interrupt_funcsP0,<br/>  const A_Time               \*startPT,<br/>  const A_Time               \*durPT,<br/>  A_u_long                   start_sampLu,<br/>  A_u_long                   num_samplesLu,<br/>  void                       \*dataPV);</pre>                                                                  |              |                                                    |
|                               | `AEIO_SndQuality` 可能为：                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |              |                                                    |
|                               | - `AEIO_SndQuality_APPROX`,（此品质用于绘制音频波形）                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |              |                                                    |
|                               | - `AEIO_SndQuality_LO`,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |              |                                                    |
|                               | - `AEIO_SndQuality_HI`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |              |                                                    |
| `AEIO_InqNextFrameTime`       | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 输入         | 是                                                 |
|                               | 提供 `AEIO_InSpecH` 中下一帧的时间（以源素材的时间基准为准）。                                                                                                                                                                                                                                                                                                                                                                                                                                                              |              |                                                    |
|                               | <pre lang="cpp">AEIO_InqNextFrameTime(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_InSpecH    inH,<br/>  const A_Time    \*base_time_tr,<br/>  AEIO_TimeDir    time_dir,<br/>  A_Boolean       \*found0,<br/>  A_Time          \*key_time_tr0);</pre>                                                                                                                                                                                                                                                                    |              |                                                    |
| `AEIO_InitOutputSpec`         | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 输出         | 是                                                 |
|                               | 执行新 `AEIO_OutSpecH` 所需的任何初始化，并指示是否进行了更改。                                                                                                                                                                                                                                                                                                                                                                                                                                                            |              |                                                    |
|                               | <pre lang="cpp">AEIO_InitOutputSpec(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_OutSpecH   outH,<br/>  A_Boolean       \*user_interacted);</pre>                                                                                                                                                                                                                                                                                                                                                                        |              |                                                    |
|                               | !!! 注意                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |              |                                                    |
|                               |      首次使用您的 AEIO 时，After Effects 会在其首选项中缓存最后已知的良好 `optionsH`。                                                                                                                                                                                                                                                                                                                                                                                                                                      |              |                                                    |
|                               | 在测试此函数时，请经常[删除您的首选项](../intro/debugging-plug-ins.md#deleting-preferences)。                                                                                                                                                                                                                                                                                                                                                                                                                               |              |                                                    |
| `AEIO_GetFlatOutputOptions`   | 在 `AEIO_Handle` 中描述 `AEIO_OutSpecH` 的输出选项，以磁盘安全的扁平数据结构（不引用外部内存）。                                                                                                                                                                                                                                                                                                                                                                                                                            | 输出         | 是                                                 |
|                               | 请注意，您的输出选项必须是跨平台的，因此请注意字节顺序问题。                                                                                                                                                                                                                                                                                                                                                                                                                                                                |              |                                                    |
|                               | <pre lang="cpp">AEIO_GetFlatOutputOptions(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_OutSpecH   outH,<br/>  AEIO_Handle     \*optionsH);</pre>                                                                                                                                                                                                                                                                                                                                                                         |              |                                                    |
| `AEIO_DisposeOutputOptions`   | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。释放传入的输出选项的内存。                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 输出         | 否                                                 |
|                               | <pre lang="cpp">AEIO_DisposeOutputOptions(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  void            \*optionsPV);</pre>                                                                                                                                                                                                                                                                                                                                                                                                    |              |                                                    |
| `AEIO_UserOptionsDialog`      | 显示输出设置对话框（在 After Effects 中选择 TIFF 输出以查看此对话框何时出现）。                                                                                                                                                                                                                                                                                                                                                                                                                                             | 输出         | 否                                                 |
|                               | 使用 `AEGP_SetInSpecOptionsHandle` 将此信息存储在选项句柄中。                                                                                                                                                                                                                                                                                                                                                                                                                                                               |              |                                                    |
|                               | <pre lang="cpp">AEIO_UserOptionsDialog(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_OutSpecH   outH,<br/>  PF_EffectWorld  \*sample0,<br/>  A_Boolean       \*interacted0);</pre>                                                                                                                                                                                                                                                                                                                                        |              |                                                    |
| `AEIO_GetOutputInfo`          | 以文本形式描述 `AEIO_OutSpecH` 中的输出选项。                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |              |                                                    |
|                               | <pre lang="cpp">AEIO_GetOutputInfo(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_OutSpecH   outH,<br/>  AEIO_Verbiage   \*verbiage);</pre>                                                                                                                                                                                                                                                                                                                                                                                |              |                                                    |
| `AEIO_OutputInfoChanged`      | 根据当前设置更新 `AEIO_OutSpecH`（使用各种 Get 函数获取它们）。                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 输出         | 否                                                 |
|                               | <pre lang="cpp">AEIO_OutputInfoChanged(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_OutSpecH   outH);</pre>                                                                                                                                                                                                                                                                                                                                                                                                              |              |                                                    |
| `AEIO_SetOutputFile`          | 允许 `AEIO_Err_USE_DFLT_CALLBACK`。设置 `AEIO_OutSpecH` 的输出文件路径。                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 输出         | 是                                                 |
|                               | 除非您更改了路径，否则返回 `AEIO_Err_USE_DEFAULT_CALLBACK`。                                                                                                                                                                                                                                                                                                                                                                                                                                                               |              |                                                    |
|                               | 文件路径是一个以 NULL 结尾的 UTF-16 字符串，带有平台分隔符。                                                                                                                                                                                                                                                                                                                                                                                                                                                               |              |                                                    |
|                               | <pre lang="cpp">AEIO_SetOutputFile(<br/>  AEIO_BasicData  \*basic_dataP,<br/>  AEIO_OutSpecH   outH,<br/>  A_UTF16Char     \*file_pathZ);</pre>                                                                                                                                                                                                                                                                                                                                                                              |              |                                                    |
| `AEIO_StartAdding`            | 准备将帧添加到输出文件中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 输出